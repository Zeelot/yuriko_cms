DROP TABLE IF EXISTS `users_roles`;
DROP TABLE IF EXISTS `user_tokens`;
DROP TABLE IF EXISTS `user_labels`;
DROP TABLE IF EXISTS `user_settings`;
DROP TABLE IF EXISTS `roles`;
DROP TABLE IF EXISTS `users`;

CREATE TABLE `users` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(32) NOT NULL,
  `password` VARCHAR(50) NOT NULL,
  `email` VARCHAR(127) NOT NULL,
  `logins` INT(10) UNSIGNED NOT NULL DEFAULT 0,
  `last_login` INT(10) UNSIGNED NULL,
  PRIMARY KEY(`id`),
  UNIQUE INDEX `uniq_username`(`username`),
  UNIQUE INDEX `uniq_email`(`email`)
)
TYPE=InnoDB;

CREATE TABLE `roles` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(32) NOT NULL,
  `description` VARCHAR(255) NOT NULL DEFAULT '',
  PRIMARY KEY(`id`),
  UNIQUE INDEX `uniq_name`(`name`)
)
TYPE=InnoDB;

CREATE TABLE `user_settings` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) UNSIGNED NOT NULL,
  `label` VARCHAR(32) NOT NULL,
  `value` VARCHAR(127) NOT NULL,
  PRIMARY KEY(`id`, `user_id`),
  INDEX `user_settings_FKIndex1`(`user_id`),
  FOREIGN KEY(`user_id`)
    REFERENCES `users`(`id`)
      ON DELETE CASCADE
      ON UPDATE NO ACTION
)
TYPE=InnoDB;

CREATE TABLE `user_labels` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) UNSIGNED NOT NULL,
  `name` VARCHAR(32) NOT NULL,
  `value` VARCHAR(127) NOT NULL,
  PRIMARY KEY(`id`, `user_id`),
  INDEX `user_labels_FKIndex1`(`user_id`),
  FOREIGN KEY(`user_id`)
    REFERENCES `users`(`id`)
      ON DELETE CASCADE
      ON UPDATE NO ACTION
)
TYPE=InnoDB;

CREATE TABLE `user_tokens` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) UNSIGNED NOT NULL,
  `user_agent` VARCHAR(40) NOT NULL,
  `token` VARCHAR(32) NOT NULL,
  `created` INT(10) UNSIGNED NOT NULL,
  `expires` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY(`id`, `user_id`),
  INDEX `user_tokens_FKIndex1`(`user_id`),
  FOREIGN KEY(`user_id`)
    REFERENCES `users`(`id`)
      ON DELETE CASCADE
      ON UPDATE NO ACTION
)
TYPE=InnoDB;

CREATE TABLE `users_roles` (
  `roles_id` INT(11) UNSIGNED NOT NULL,
  `users_id` INT(11) UNSIGNED NOT NULL,
  PRIMARY KEY(`roles_id`, `users_id`),
  INDEX `users_has_roles_FKIndex2`(`roles_id`),
  INDEX `users_roles_FKIndex2`(`users_id`),
  FOREIGN KEY(`users_id`)
    REFERENCES `users`(`id`)
      ON DELETE CASCADE
      ON UPDATE NO ACTION,
  FOREIGN KEY(`roles_id`)
    REFERENCES `roles`(`id`)
      ON DELETE CASCADE
      ON UPDATE NO ACTION
)
TYPE=InnoDB;
